---
title: "競馬予想のために 「上馬評: A-gebahyo」 というデータ可視化サイトをつくった"
emoji: "🏇"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [
    "上馬評",
    "競馬",
    "データ分析",
    "可視化"
]
published: false
# published_at: 2023-07-01 07:01 # 未来の日時を指定する
---

# TL; DR

- 毎日行われるすべてのレースに対してデータを提供
- もちろん毎日自動更新
- 可視化項目を充実させるため React component への貢献を募集

# 全体構成: Architecture

1. フロントエンド
    - SSG: Docusaurus (v3.alpha) + MDX (v2)
    - テンプレートエンジン: Eta (v3)
    - グラフ描画: ReChart (v2.7)
2. バックエンド
    - GCP で色々（詳細はヒミツ🔥）
3. その他
    - GAS: レース開始時刻１時間前くらいに当該記事に関するツイートを自動発信


Eta で毎日記事を生成し、GitHub Actions でスケジューリングした時刻にページをビルド＆デプロイ
記事の内容はすべて自動で生成されるので人の手は介在しない！

# SSG

もちろん Next.js やその他 MDX が利用できるフレームワークはいくつかあれど、CSS やらデザインやらをほぼ弄らずに手間なく公開できるというニーズを満たすのは Docusaurus しか思いつかなかった。
まぁ自分の個人ブログでも採用しているし、一番身近に感じていたというのが大きいかもしれない。

今後動的に動かしたいという需要が高まれば、 Next.js に乗り換えることも検討したい。

現段階では v3.alpha を採用しているが、これは MDX v2 を使えるからという理由がある。
v2.4 系が `stable` ではあるのだが、開発チームの主軸はすでに v3 に移っており、今から敢えて v2.x を使う理由は大きくなかった。

# テンプレートエンジン

もっとも有名なのは Python なら `jinja2`, Javascript 系なら `mustache` などだろうか。
TypeScript 対応していて、開発が止まっておらず、非同期に処理してくれる、等々の条件を鑑みたときに Eta.js を使うのが良さそうという結論に至った。

元々は HTML を出力するためのものだが、他のいかなる形式のファイルでも対応しているというのが魅力だったかもしれない。
MDX 出力に利用しているという前例があったかどうか詳しく調べていないが、とても快適に利用できているので皆様もぜひ触れてみてほしい。

# グラフ描画

逆説的だが、この ReChart.js が使えるから MDX を使う => そのために Docusaurus を使うという構想を抱えていた。
React component として利用でき、 SVG で描画され、TypeScript にも対応しており、なによりシンプルにきれい！

# 自動ツイート

Google App Script + Spread Sheet でレース開始時刻一時間前になったら当該記事をツイートして広報するようなBOTも作成した
シートをCMSとして採用し、GitHub Actions で毎朝シート内容を更新し、GASスクリプトは１０分ごとに発火させる仕組みだ。

Twitter APIの制限がキツイため泣く泣く最大ツイート数を絞ったのだけは悔やまれる。
50 以下になるまで削ってからCMS更新を掛けている。

~~ふぁっきゅーいーろん~~

# アピールポイント

ここまで見てもらってだいたい分かる人にはわかるのだが、上記の構成はすべて「無料」で実現できる。
プラットフォーマーのノブリス・オブリージュに最大限フリーライドさせてもらっているカタチだ。

# 感想

競馬はウマ娘をきっかけに追うようになったが、最初の一年でえげつない負けを経験してデータを見ずに買うのは辞めようと決めた。
そこからコツコツいろいろやるようになり、今年に入ってからはGCPでもお安く何でもできることが理解できる経験を重ね、それがあって今回のサイト作成に繋がった。

残念ながら上半期の注目レースは殆ど終わってしまったため、夏の放牧を挟んで秋からが本番となる。

まず目指すのはスプリンターズS。

あと三ヶ月弱でどのくらい予想材料として貢献できるようになるか、精進を続けたい。
